#:import dp kivy.metrics.dp
#:import FocusBehavior kivy.uix.behaviors.focus

# -----------------------------
# LOGIN
# -----------------------------

<LoginScreen>:
    ScrollView:
        do_scroll_x: False
        do_scroll_y: True
        bar_width: dp(4)

        # ✅ Container rolável (precisa ter minimum_height)
        MDBoxLayout:
            id: scroll_box
            orientation: "vertical"
            size_hint_x: 1
            size_hint_y: None
            height: self.minimum_height
            padding: 0, 0

            # ✅ "Palco" para centralizar vertical e horizontal
            AnchorLayout:
                id: stage
                size_hint_x: 1
                size_hint_y: None

                # altura do palco = o maior entre (altura da tela) e (altura do conteúdo)
                height: max(root.height, content_box.minimum_height)

                anchor_x: "center"
                anchor_y: "center"

                # ✅ Caixa que define o conteúdo (tem minimum_height!)
                MDBoxLayout:
                    id: content_box
                    orientation: "vertical"
                    size_hint_x: None
                    width: min(root.width - dp(40), dp(440))
                    size_hint_y: None
                    height: self.minimum_height
                    padding: dp(20)
                    spacing: dp(14)

                    # === Seu card (mantive seu conteúdo original) ===
                    MDCard:
                        id: _content_card
                        size_hint_x: 1
                        size_hint_y: None
                        height: self.minimum_height
                        radius: [16, 16, 16, 16]
                        padding: dp(20)
                        elevation: 2
                        md_bg_color: 1, 1, 1, 1

                        MDBoxLayout:
                            orientation: "vertical"
                            size_hint_y: None
                            height: self.minimum_height
                            spacing: dp(14)

                            # --- Cabeçalho (logo + título + subtítulo) ---
                            MDBoxLayout:
                                orientation: "vertical"
                                spacing: dp(8)
                                size_hint_y: None
                                height: self.minimum_height

                                AnchorLayout:
                                    size_hint_y: None
                                    height: dp(48)
                                    anchor_x: "center"
                                    anchor_y: "center"

                                    Image:
                                        source: "assets/images/logo_jogamos.jpg"
                                        allow_stretch: True
                                        keep_ratio: True
                                        size_hint: None, None
                                        height: dp(40)
                                        width: dp(120)

                                MDLabel:
                                    text: "Login"
                                    font_style: "H5"
                                    halign: "left"
                                    size_hint_y: None
                                    height: self.texture_size[1]

                                MDLabel:
                                    text: "Estamos muito felizes que você voltou. Entre com seu e‑mail e sua senha ou com suas redes sociais"
                                    theme_text_color: "Secondary"
                                    font_size: "13sp"
                                    halign: "left"
                                    size_hint_y: None
                                    text_size: self.width, None
                                    height: self.texture_size[1]

                            # --- Campo E-mail ---
                            JogamosTextField:
                                id: email_input
                                hint_text: "E-mail"
                                focus_next: password_input
                                on_text_validate: password_input.focus = True

                            # --- Campo Senha + “olho” ---
                            MDRelativeLayout:
                                size_hint_y: None
                                height: dp(56)

                                JogamosTextField:
                                    id: password_input
                                    hint_text: "Senha"
                                    password: True
                                    pos_hint: {"center_y": 0.5}
                                    focus_previous: email_input
                                    focus_next: login_btn
                                    on_text_validate: root.do_login(email_input.text.strip(), password_input.text)

                                MDIconButton:
                                    icon: "eye-off" if password_input.password else "eye"
                                    pos_hint: {"center_y": 0.5}
                                    theme_icon_color: "Custom"
                                    icon_color: app.theme_cls.primary_color
                                    x: password_input.x + password_input.width - self.width - dp(8)
                                    on_release:
                                        password_input.password = not password_input.password
                                        self.icon = "eye-off" if password_input.password else "eye"

                            # --- Botão Login ---
                            FocusCardButton:
                                id: login_btn
                                on_release: root.do_login(email_input.text.strip(), password_input.text)
                                MDBoxLayout:
                                    padding: dp(16), 0
                                    MDLabel:
                                        text: "Login"
                                        halign: "center"
                                        color: 1, 1, 1, 1
                                        bold: True

                            DividerWithText:
                                text: "ou"

                            # --- Sociais ---
                            MDBoxLayout:
                                orientation: "vertical"
                                spacing: dp(12)
                                size_hint_y: None
                                height: self.minimum_height

                                MDCard:
                                    size_hint_y: None
                                    size_hint_x: 1
                                    height: dp(56)
                                    radius: [16, 16, 16, 16]
                                    md_bg_color: 0.07, 0.07, 0.07, 1
                                    ripple_behavior: True
                                    on_release: app.toast("Google: em breve (UI)")
                                    MDBoxLayout:
                                        padding: dp(16), 0
                                        MDLabel:
                                            text: "Continue com o Google"
                                            halign: "center"
                                            color: 1, 1, 1, 1
                                            bold: True

                                MDCard:
                                    size_hint_y: None
                                    size_hint_x: 1
                                    height: dp(56)
                                    radius: [16, 16, 16, 16]
                                    md_bg_color: 0.07, 0.07, 0.07, 1
                                    ripple_behavior: True
                                    on_release: app.toast("Facebook: em breve (UI)")
                                    MDBoxLayout:
                                        padding: dp(16), 0
                                        MDLabel:
                                            text: "Continue com o Facebook"
                                            halign: "center"
                                            color: 1, 1, 1, 1
                                            bold: True

                                MDCard:
                                    size_hint_y: None
                                    size_hint_x: 1
                                    height: dp(56)
                                    radius: [16, 16, 16, 16]
                                    md_bg_color: 0.07, 0.07, 0.07, 1
                                    ripple_behavior: True
                                    on_release: app.toast("Apple: em breve (UI)")
                                    MDBoxLayout:
                                        padding: dp(16), 0
                                        MDLabel:
                                            text: "Continue com a Apple"
                                            halign: "center"
                                            color: 1, 1, 1, 1
                                            bold: True

                            MDLabel:
                                size_hint_y: None
                                height: dp(8)

                            AnchorLayout:
                                size_hint_y: None
                                height: dp(40)
                                anchor_x: "center"

                                MDTextButton:
                                    text: "Cadastrar"
                                    theme_text_color: "Custom"
                                    text_color: 0.117, 0.227, 0.996, 1
                                    on_release: app.root.current = "signup"



# -----------------------------
# SIGNUP
# -----------------------------
<SignupScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(12)
        size_hint_x: None
        width: min(root.width, dp(440))
        pos_hint: {"center_x": 0.5, "center_y": 0.5}

        Headline:
            text: "Criar conta"

        AuthTextField:
            id: signup_email_input
            hint_text: "E-mail"
            icon_right: "email-outline"
            focus_next: signup_password_input
            on_text_validate: signup_password_input.focus = True

        # --- Campo Senha com "olho" ---
        MDRelativeLayout:
            size_hint_y: None
            height: dp(68)

            MDTextField:
                id: signup_password_input
                hint_text: "Senha"
                mode: "rectangle"
                multiline: False
                write_tab: False
                password: True
                size_hint_y: None
                height: dp(68)
                pos_hint: {"center_y": 0.5}
                focus_next: signup_confirm_input
                focus_previous: signup_email_input
                on_text_validate: signup_confirm_input.focus = True

            MDIconButton:
                id: eye_btn_signup_pwd
                icon: "eye-off" if signup_password_input.password else "eye"
                pos_hint: {"center_y": 0.5}
                theme_icon_color: "Custom"
                icon_color: app.theme_cls.primary_color
                x: signup_password_input.x + signup_password_input.width - self.width - dp(8)
                on_release:
                    signup_password_input.password = not signup_password_input.password
                    self.icon = "eye-off" if signup_password_input.password else "eye"

        # --- Campo Confirmar senha com "olho" ---
        MDRelativeLayout:
            size_hint_y: None
            height: dp(68)

            MDTextField:
                id: signup_confirm_input
                hint_text: "Confirmar senha"
                mode: "rectangle"
                multiline: False
                write_tab: False
                password: True
                size_hint_y: None
                height: dp(68)
                pos_hint: {"center_y": 0.5}
                focus_next: signup_create_btn
                focus_previous: signup_password_input
                on_text_validate: root.create_account(signup_email_input.text.strip(), signup_password_input.text, signup_confirm_input.text)

            MDIconButton:
                id: eye_btn_signup_confirm
                icon: "eye-off" if signup_confirm_input.password else "eye"
                pos_hint: {"center_y": 0.5}
                theme_icon_color: "Custom"
                icon_color: app.theme_cls.primary_color
                x: signup_confirm_input.x + signup_confirm_input.width - self.width - dp(8)
                on_release:
                    signup_confirm_input.password = not signup_confirm_input.password
                    self.icon = "eye-off" if signup_confirm_input.password else "eye"

        # Botão focável
        FocusPrimaryButton:
            id: signup_create_btn
            text: "Criar conta"
            on_release: root.create_account(signup_email_input.text.strip(), signup_password_input.text, signup_confirm_input.text)

        MDTextButton:
            text: "Já tenho conta — voltar ao login"
            halign: "center"
            theme_text_color: "Custom"
            text_color: app.theme_cls.primary_color
            on_release: app.root.current = "login"


# -----------------------------
# FORGOT PASSWORD
# -----------------------------
<ForgotPasswordScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(12)
        size_hint_x: None
        width: min(root.width, dp(440))
        pos_hint: {"center_x": 0.5, "center_y": 0.5}

        Headline:
            text: "Recuperar senha"
        Subtle:
            text: "Informe seu e-mail para receber instruções."

        AuthTextField:
            id: forgot_email_input
            hint_text: "E-mail cadastrado"
            icon_right: "email-outline"
            focus_next: forgot_send_btn
            on_text_validate: forgot_send_btn.focus = True

        # Botão focável
        FocusPrimaryButton:
            id: forgot_send_btn
            text: "Enviar"
            on_release: root.send_reset(forgot_email_input.text.strip())

        MDTextButton:
            text: "Voltar ao login"
            halign: "center"
            theme_text_color: "Custom"
            text_color: app.theme_cls.primary_color
            on_release: app.root.current = "login"


# -----------------------------
# VERIFY TOKEN
# -----------------------------
<VerifyTokenScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(12)
        size_hint_x: None
        width: min(root.width, dp(440))
        pos_hint: {"center_x": 0.5, "center_y": 0.5}

        Headline:
            text: "Verificar e-mail"
        Subtle:
            text: "Enviamos um token para " + root.email

        AuthTextField:
            id: token_input
            hint_text: "Token recebido por e-mail"
            icon_right: "numeric"
            focus_next: verify_btn
            on_text_validate: root.verify_token(token_input.text.strip())

        # Botão focável
        FocusPrimaryButton:
            id: verify_btn
            text: "Validar token"
            on_release: root.verify_token(token_input.text.strip())

        MDBoxLayout:
            size_hint_y: None
            height: dp(40)
            spacing: dp(8)
            MDWidget:
            MDTextButton:
                text: "Reenviar token"
                theme_text_color: "Custom"
                text_color: app.theme_cls.primary_color
                on_release: root.resend_token()
            MDTextButton:
                text: "Voltar ao login"
                theme_text_color: "Custom"
                text_color: app.theme_cls.primary_color
                on_release: app.root.current = "login"
            MDWidget:
