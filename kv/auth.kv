#:import dp kivymd.material_resources.dp
#:import FocusBehavior kivy.uix.behaviors.focus

# -----------------------------
# LOGIN
# -----------------------------


LoginCtaButton@FocusBehavior+MDButton>:
    size_hint_y: None
    height: dp(56)
    size_hint_x: 1
    style: "filled"
    md_bg_color: 0.039, 0.220, 1.0, 1     # #0A38FF
    text_color: 1, 1, 1, 1
    radius: [24, 24, 24, 24]
    elevation: 4

<LoginScreen>:
    md_bg_color: 0.97, 0.97, 0.98, 1   # fundo claro suave como no mock
    ScrollView:
        do_scroll_x: False
        do_scroll_y: True
        bar_width: dp(4)        

        MDBoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: self.minimum_height

            AnchorLayout:
                size_hint_y: None
                height: max(root.height, content_box.minimum_height)
                anchor_x: "center"
                anchor_y: "center"

                LoginMaxWidthBox:
                    id: content_box

                    # —— bloco principal (sem card de fundo) ——
                    MDBoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(16)

                        # LOGO
                        AnchorLayout:
                            size_hint_y: None
                            height: dp(70)
                            anchor_x: "center"
                            anchor_y: "center"
                            Image:
                                source: "assets/images/logo_jogamos.jpg"
                                size_hint: None, None
                                width: dp(140)
                                height: dp(32)
                                allow_stretch: True
                                keep_ratio: True

                        # TÍTULO / SUBTÍTULO
                        MDBoxLayout:
                            orientation: "vertical"
                            size_hint_y: None
                            height: self.minimum_height
                            spacing: dp(6)
                            LoginTitle:
                                text: "Login"
                            LoginSubtitle:
                                text: "Estamos muito felizes que você voltou. Entre com seu e‑mail e sua senha ou com suas redes sociais"

                        # CAMPOS
                        JogamosTextField:
                            id: email_input
                            hint_text: "E-mail"
                            MDTextFieldTrailingIcon:
                                icon: "email-outline"
                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(56)
                            MDRelativeLayout:
                                size_hint_y: None
                                height: dp(56)                                                                
                                JogamosTextField:
                                    id: password_input
                                    hint_text: "Senha"
                                    password: True
                                    pos_hint: {"center_y": 0.5}
                                    focus_previous: email_input
                                    focus_next: login_btn
                                    on_text_validate: root.do_login(email_input.text.strip(), password_input.text)

                                MDIconButton:
                                    icon: "eye-off" if password_input.password else "eye"
                                    pos_hint: {"center_y": 0.5}
                                    theme_icon_color: "Custom"
                                    icon_color: app.theme_cls.primaryColor
                                    x: password_input.x + password_input.width - self.width - dp(8)
                                    on_release:
                                        password_input.password = not password_input.password
                                        self.icon = "eye-off" if password_input.password else "eye"

                        # CTA (AZUL)
                        LoginCtaButton:
                            id: login_btn
                            on_release: root.do_login(email_input.text.strip(), password_input.text)
                            MDButtonText:
                                text: "Login"

                        # SEPARADOR
                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(8)
                        DividerWithTextThin:
                            text: "ou"

                        # SOCIAIS (pretos, radius 24, ícone à esquerda)
                        SocialBlackButton:
                            on_release: app.toast("Google: em breve")
                            MDBoxLayout:
                                padding: dp(18), 0
                                spacing: dp(14)
                                adaptive_height: True
                                MDIcon:
                                    icon: "google"
                                    theme_icon_color: "Custom"
                                    icon_color: 1, 1, 1, 1
                                MDLabel:
                                    text: "Continue com o Google"
                                    halign: "center"
                                    color: 1, 1, 1, 1
                                    bold: True
                        SocialBlackButton:
                            on_release: app.toast("Facebook: em breve")
                            MDBoxLayout:
                                padding: dp(18), 0
                                spacing: dp(14)
                                adaptive_height: True
                                MDIcon:
                                    icon: "facebook"
                                    theme_icon_color: "Custom"
                                    icon_color: 1, 1, 1, 1
                                MDLabel:
                                    text: "Continue com o Facebook"
                                    halign: "center"
                                    color: 1, 1, 1, 1
                                    bold: True
                        SocialBlackButton:
                            on_release: app.toast("Apple: em breve")
                            MDBoxLayout:
                                padding: dp(18), 0
                                spacing: dp(14)
                                adaptive_height: True
                                MDIcon:
                                    icon: "apple"
                                    theme_icon_color: "Custom"
                                    icon_color: 1, 1, 1, 1
                                MDLabel:
                                    text: "Continue com a Apple"
                                    halign: "center"
                                    color: 1, 1, 1, 1
                                    bold: True

                        # LINK “CADASTRAR”
                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(10)
                        AnchorLayout:
                            size_hint_y: None
                            height: dp(30)
                            anchor_x: "center"
                            MDButton:
                                style: "text"
                                on_release: app.root.current = "signup"                                
                                MDButton:
                                    style: "text"
                                    theme_text_color: "Custom"
                                    text_color: app.theme_cls.primaryColor
                                    on_release: app.root.current = "signup"
                                    MDButtonText:
                                        text: "Cadastrar"


# -----------------------------
# SIGNUP
# -----------------------------
<SignupScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(12)
        size_hint_x: None
        width: min(root.width, dp(440))
        pos_hint: {"center_x": 0.5, "center_y": 0.5}

        Headline:
            text: "Criar conta"

        AuthTextField:
            id: signup_email_input
            hint_text: "E-mail"
            focus_next: signup_password_input
            on_text_validate: signup_password_input.focus = True
            MDTextFieldTrailingIcon:
                icon: "email-outline"

        # --- Campo Senha com "olho" ---
        MDRelativeLayout:
            size_hint_y: None
            height: dp(56)

            JogamosTextField:
                id: signup_password_input
                hint_text: "Senha"
                password: True
                pos_hint: {"center_y": 0.5}
                focus_next: signup_confirm_input
                focus_previous: signup_email_input
                on_text_validate: signup_confirm_input.focus = True

            MDIconButton:
                id: eye_btn_signup_pwd
                icon: "eye-off" if signup_password_input.password else "eye"
                pos_hint: {"center_y": 0.5}
                theme_icon_color: "Custom"
                icon_color: app.theme_cls.primaryColor
                x: signup_password_input.x + signup_password_input.width - self.width - dp(8)
                on_release:
                    signup_password_input.password = not signup_password_input.password
                    self.icon = "eye-off" if signup_password_input.password else "eye"

        # --- Campo Confirmar senha com "olho" ---
        MDRelativeLayout:
            size_hint_y: None
            height: dp(56)

            JogamosTextField:
                id: signup_confirm_input
                hint_text: "Confirmar senha"
                password: True
                pos_hint: {"center_y": 0.5}
                focus_next: signup_create_btn
                focus_previous: signup_password_input
                on_text_validate: root.create_account(signup_email_input.text.strip(), signup_password_input.text, signup_confirm_input.text)

            MDIconButton:
                id: eye_btn_signup_confirm
                icon: "eye-off" if signup_confirm_input.password else "eye"
                pos_hint: {"center_y": 0.5}
                theme_icon_color: "Custom"
                icon_color: app.theme_cls.primaryColor
                x: signup_confirm_input.x + signup_confirm_input.width - self.width - dp(8)
                on_release:
                    signup_confirm_input.password = not signup_confirm_input.password
                    self.icon = "eye-off" if signup_confirm_input.password else "eye"

        # Botão focável (MDButton estilizado no theme.kv)
        FocusPrimaryButton:
            id: signup_create_btn
            on_release: root.create_account(signup_email_input.text.strip(), signup_password_input.text, signup_confirm_input.text)
            MDButtonText:
                text: "Criar conta"

        MDButton:
            style: "text"
            on_release: app.root.current = "login"
            MDButtonText:
                text: "Já tenho conta — voltar ao login"
                theme_text_color: "Custom"
                text_color: app.theme_cls.primaryColor


# -----------------------------
# FORGOT PASSWORD
# -----------------------------
<ForgotPasswordScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(12)
        size_hint_x: None
        width: min(root.width, dp(440))
        pos_hint: {"center_x": 0.5, "center_y": 0.5}

        Headline:
            text: "Recuperar senha"
        Subtle:
            text: "Informe seu e-mail para receber instruções."

        AuthTextField:
            id: forgot_email_input
            hint_text: "E-mail cadastrado"
            focus_next: forgot_send_btn
            on_text_validate: forgot_send_btn.focus = True
            MDTextFieldTrailingIcon:
                icon: "email-outline"

        FocusPrimaryButton:
            id: forgot_send_btn
            on_release: root.send_reset(forgot_email_input.text.strip())
            MDButtonText:
                text: "Enviar"

        MDButton:
            style: "text"
            on_release: app.root.current = "login"
            MDButtonText:
                text: "Voltar ao login"
                theme_text_color: "Custom"
                text_color: app.theme_cls.primaryColor


# -----------------------------
# VERIFY TOKEN
# -----------------------------
<VerifyTokenScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(12)
        size_hint_x: None
        width: min(root.width, dp(440))
        pos_hint: {"center_x": 0.5, "center_y": 0.5}

        Headline:
            text: "Verificar e-mail"
        Subtle:
            text: "Enviamos um token para " + root.email

        AuthTextField:
            id: token_input
            hint_text: "Token recebido por e-mail"
            focus_next: verify_btn
            on_text_validate: root.verify_token(token_input.text.strip())
            MDTextFieldTrailingIcon:
                icon: "numeric"

        FocusPrimaryButton:
            id: verify_btn
            on_release: root.verify_token(token_input.text.strip())
            MDButtonText:
                text: "Validar token"

        MDBoxLayout:
            size_hint_y: None
            height: dp(40)
            spacing: dp(8)
            MDWidget:
            MDButton:
                style: "text"
                theme_text_color: "Custom"
                text_color: app.theme_cls.primaryColor
                on_release: root.resend_token()
                MDButtonText:
                    text: "Reenviar token"
            
                MDButton:
                    style: "text"
                    theme_text_color: "Custom"
                    text_color: app.theme_cls.primaryColor
                    on_release: app.root.current = "login"
                    MDButtonText:
                        text: "Voltar ao login"

            MDWidget:
